# Food2Mood API

API для системы рекомендаций блюд Food2Mood, построенное на FastAPI.

## Установка и запуск

### 1. Установка зависимостей

```bash
pip install -r api/requirements.txt
```

### 2. Запуск API

```bash
python run_api.py
```

Или напрямую:

```bash
uvicorn api.main:app --host 0.0.0.0 --port 8000 --reload
```

### 3. Доступ к документации

После запуска API будет доступно по адресу:
- **Swagger UI**: http://localhost:8000/docs
- **ReDoc**: http://localhost:8000/redoc
- **API**: http://localhost:8000

## Структура API

### Основные эндпоинты

#### Пользователи (`/api/v1/users/`)

##### Проверка регистрации пользователя
- `GET /check/{phone}` - Проверка регистрации пользователя по номеру телефона

**Параметры:**
- `phone` (path) - Номер телефона пользователя

**Ответ:**
```json
{
  "registered": true,
  "user_id": 123456789,
  "message": "Пользователь зарегистрирован"
}
```

или

```json
{
  "registered": false,
  "message": "Пользователь не найден"
}
```

##### Регистрация пользователя
- `POST /register` - Регистрация нового пользователя по номеру телефона

**Параметры (query):**
- `phone` (обязательный) - Номер телефона (основной аргумент регистрации)
- `user_id` (опциональный) - ID пользователя (если не указан, генерируется автоматически)
- `user_name` (опциональный) - Имя пользователя
- `user_first_name` (опциональный) - Имя
- `user_last_name` (опциональный) - Фамилия

**Ответ:**
```json
{
  "message": "Пользователь успешно зарегистрирован",
  "user_id": 123456789,
  "phone": "+1234567890"
}
```

#### Анкеты (`/api/v1/`)

##### Отправка параметров анкеты
- `POST /questionnaire` - Отправка параметров анкеты с вставкой в базу данных

**Тело запроса:**
```json
{
  "user_id": 123456789,
  "mood": "Радость",
  "hungry": 7,
  "prefers": "Хочу экспериментов",
  "sex": "Мужчина",
  "age": "26-35",
  "food_style": "Стандартное",
  "ccal": "<500",
  "dont_like_to_eat": "лук, чеснок",
  "like_to_eat": "курица, рис"
}
```

**Параметры:**
- `user_id` (обязательный) - ID пользователя
- `mood` (опциональный) - Настроение: "Спокойствие", "Радость", "Печаль", "Гнев", "Волнение"
- `hungry` (опциональный) - Уровень голода: 2, 5, 7, 10
- `prefers` (опциональный) - Предпочтения: "Мне как обычно", "Хочу экспериментов"
- `sex` (опциональный) - Пол: "Мужчина", "Женщина"
- `age` (опциональный) - Возраст: "До 18", "18-25", "26-35", "36-45", "45+"
- `food_style` (опциональный) - Стиль питания: "Стандартное", "Диетическое", "Вегетарианское", "Веганское", "Кето", "Палео"
- `ccal` (опциональный) - Калории: "<300", "<500", "<700"
- `dont_like_to_eat` (опциональный) - Нелюбимые продукты (через запятую)
- `like_to_eat` (опциональный) - Любимые продукты (через запятую)

**Ответ:**
```json
{
  "message": "Анкета успешно сохранена",
  "user_id": 123456789
}
```

#### Меню (`/api/v1/menu/`)

##### Получение отсортированного списка позиций
- `GET /` - Получить отсортированный список позиций меню с возможностью фильтрации

**Параметры (query):**
- `category` (опциональный) - Фильтр по категории
- `restaurant` (опциональный) - Фильтр по ресторану
- `min_price` (опциональный) - Минимальная цена
- `max_price` (опциональный) - Максимальная цена

**Ответ:**
```json
[
  {
    "id": 1,
    "dish_name": "Курица в кляре",
    "dish_category": "Основные блюда",
    "dish_price": 750,
    "dish_g": "300г",
    "size": "Средняя",
    "simple_ingridients": "Курица, мука, яйца, специи",
    "additional_dishes": null,
    "iiko_id": null,
    "dish_rec_nutritionist": null,
    "dish_rec_community": null,
    "dish_rec_a_oblomov": null,
    "dish_rec_a_ivlev": null,
    "stat_reviews": null,
    "stat_rating": null
  }
]
```

## Примеры использования

### Проверка регистрации пользователя

```bash
curl -X GET "http://localhost:8000/api/v1/users/check/+1234567890"
```

### Регистрация пользователя

```bash
curl -X POST "http://localhost:8000/api/v1/users/register?phone=%2B1234567890&user_name=test_user&user_first_name=Test&user_last_name=User"
```

### Отправка анкеты

```bash
curl -X POST "http://localhost:8000/api/v1/questionnaire" \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": 123456789,
    "mood": "Радость",
    "hungry": 7,
    "prefers": "Хочу экспериментов",
    "sex": "Мужчина",
    "age": "26-35",
    "food_style": "Стандартное",
    "dont_like_to_eat": "лук, чеснок",
    "like_to_eat": "курица, рис"
  }'
```

### Получение меню

```bash
curl -X GET "http://localhost:8000/api/v1/menu/"
```

### Получение меню с фильтрами

```bash
curl -X GET "http://localhost:8000/api/v1/menu/?category=Основные%20блюда&min_price=500&max_price=1000"
```

## Модели данных

### Параметры анкеты
```json
{
  "user_id": 123456789,
  "mood": "Радость",
  "hungry": 7,
  "prefers": "Хочу экспериментов",
  "sex": "Мужчина",
  "age": "26-35",
  "food_style": "Стандартное",
  "ccal": "<500",
  "dont_like_to_eat": "лук, чеснок",
  "like_to_eat": "курица, рис"
}
```

### Блюдо
```json
{
  "id": 1,
  "dish_name": "Курица в кляре",
  "dish_category": "Основные блюда",
  "dish_price": 750,
  "dish_g": "300г",
  "size": "Средняя",
  "simple_ingridients": "Курица, мука, яйца, специи"
}
```

## Обработка ошибок

API возвращает стандартные HTTP коды ошибок:

- `200` - Успешный запрос
- `201` - Ресурс создан
- `400` - Неверный запрос
- `404` - Ресурс не найден
- `500` - Внутренняя ошибка сервера

Пример ошибки:
```json
{
  "detail": "Пользователь не найден"
}
```

## Развертывание

### Переменные окружения

```bash
export DATABASE_URL="sqlite:///files/databse.db"
```

## Поддержка

Для вопросов и предложений обращайтесь к разработчикам проекта.
